<!-- src/app/features/todo/pages/todo-page.component.html -->

<div class="flex flex-col justify-center gap-12 w-full">
  <!-- Filtros -->
  <p-card>
    <section class="p-4">
      <h2 class="text-xl font-semibold mb-4">Filtrar Tareas</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <input
          type="text"
          pInputText
          placeholder="Título"
          [(ngModel)]="filters.title"
          (ngModelChange)="applyFilters()"
        />
        <input
          type="text"
          pInputText
          placeholder="Categoría"
          [(ngModel)]="filters.category"
          (ngModelChange)="applyFilters()"
        />
        <p-calendar
          [(ngModel)]="filters.createdAt"
          (ngModelChange)="applyFilters()"
          placeholder="Fecha de creación"
          dateFormat="yy-mm-dd"
          showIcon
        />
        <p-calendar
          [(ngModel)]="filters.startDate"
          (ngModelChange)="applyFilters()"
          placeholder="Fecha de inicio"
          dateFormat="yy-mm-dd"
          showIcon
        />
        <p-dropdown
          [options]="statusOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Estado"
          [(ngModel)]="filters.statusId"
          (ngModelChange)="applyFilters()"
        ></p-dropdown>
      </div>
    </section>
  </p-card>

  <!-- Botón Crear Tarea -->
  <p-button
    label="Crear Tarea"
    icon="pi pi-plus"
    class="mb-4"
    (onClick)="showCreateModal = true"
  ></p-button>

  <!-- Tabla de Tareas -->
  <p-card>
    <section class="p-4">
      <h2 class="text-xl font-semibold mb-4">Lista de Tareas</h2>

      <p-table
        [value]="filteredTasks"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5, 10, 20]"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Categoría</th>
            <th>Estado</th>
            <th>Fecha de Creación</th>
            <th>Fecha de Inicio</th>
            <th>Fecha de finalizacion estimada</th>
            <th>Fecha de finalizacion</th>
            <th>Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-task>
          <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.category }}</td>
            <td>{{ getStatusLabel(task.statusId) }}</td>
            <td>{{ task.createdAt }}</td>
            <td>{{ task.startDate }}</td>
            <td>{{ task.estimatedEndDate }}</td>
            <td>{{ task.realEndDate }}</td>
            <td>
              <button
                pButton
                icon="pi pi-pencil"
                class="p-button-sm p-button-text"
                (click)="editTask(task)"
              ></button>
              <button
                pButton
                icon="pi pi-trash"
                class="p-button-sm p-button-text text-red-500"
                (click)="deleteTask(task.id)"
              ></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </section>
  </p-card>

  <!-- Modal Crear -->
<task-create-modal [(visible)]="showCreateModal" [taskToEdit]="taskToEdit" (taskCreated)="onTaskCreated()"
  (taskUpdated)="onTaskUpdated()"
  />

</div>
